{%- liquid
  if section.settings.media_size == 'large'
    assign media_width = 0.65
  elsif section.settings.media_size == 'medium'
    assign media_width = 0.55
  elsif section.settings.media_size == 'small'
    assign media_width = 0.45
  endif

  assign media_count = product.media.size
-%}

<product-gallery>
  <div class="swiper-container swiper-loading" 
       id="product-gallery-swiper-{{ section.id }}"
       data-enable-loop="{{ section.settings.enable_swiper_loop }}"
       data-enable-autoplay="{{ section.settings.enable_swiper_autoplay }}"
       data-autoplay-delay="{{ section.settings.swiper_autoplay_delay | default: 3000 }}"
       data-slides-per-view="{{ section.settings.swiper_slides_per_view_desktop | default: 1 }}"
       data-space-between="{{ section.settings.swiper_space_between | default: 10 }}">
    {% render 'loading-spinner', class: 'gallery-loading__spinner' %}
    <div class="swiper-wrapper">
      {%- for media in product.media -%}
        <div class="swiper-slide" data-color="{{ media.alt | escape | downcase }}">
          {% render 'product-thumbnail',
            media: media,
            media_count: media_count,
            position: forloop.index,
            desktop_layout: section.settings.gallery_layout,
            mobile_layout: section.settings.mobile_thumbnails,
            loop: section.settings.enable_video_looping,
            modal_id: section.id,
            xr_button: true,
            media_width: media_width,
            media_fit: section.settings.media_fit,
            constrain_to_viewport: section.settings.constrain_to_viewport,
            lazy_load: false
          %}
        </div>
      {%- endfor -%}
    </div>
    <div class="swiper-pagination"></div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
  </div>
</product-gallery>

<script>
  // Pass section settings to JavaScript
  window.sectionSettings = window.sectionSettings || {};
  window.sectionSettings['{{ section.id }}'] = {
    enable_swiper_loop: {{ section.settings.enable_swiper_loop | json }},
    enable_swiper_autoplay: {{ section.settings.enable_swiper_autoplay | json }},
    swiper_autoplay_delay: {{ section.settings.swiper_autoplay_delay | default: 3000 | json }},
    swiper_slides_per_view_desktop: {{ section.settings.swiper_slides_per_view_desktop | default: 1 | json }},
    swiper_space_between: {{ section.settings.swiper_space_between | default: 10 | json }}
  };
</script>
